# Sanitary Pads Shop - Supabase Backend Guide

This document serves as the backend reference manual for the Sanitary Pads E-commerce project. It covers database schema, storage configuration, and integration patterns.

## 1. Environment Setup (Configuration)

### 1.1 Environment Variables

Ensure your `.env.local` file in the project root contains the following keys.  
**Important:** You must restart your development server (`npm run dev`) after changing these values.

```env
VITE_SUPABASE_URL=https://your-project-ref.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-public-key
```

### 1.2 Client Initialization

The connection logic is located in `src/supabaseClient.js`:

```javascript
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```

## 2. Database Schema

We utilize a Simplified Single-Table Architecture to manage the 4 core products effectively.

### 2.1 Table: `products`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | bigint | Primary Key (Auto-increment) |
| `name` | text | Product Name (e.g., "Cloud Soft Day") |
| `category` | text | 'day', 'night', 'super_night', 'liner' |
| `price` | decimal | Unit Price (e.g., 12.00) |
| `stock_quantity` | int | Current Stock Level |
| `specifications` | text | Product Specs (e.g., "240mm / 10 Pads") |
| `description` | text | Marketing Copy |
| `images` | text[] | Array of URLs. Index 0 is the cover image. |
| `created_at` | timestamp | Creation Time |

### 2.2 Initialization SQL

Run the following in the Supabase SQL Editor to reset/create the database:

```sql
-- 1. Schema Setup
CREATE TABLE IF NOT EXISTS products (
  id bigint generated by default as identity primary key,
  name text not null,
  description text,
  price decimal(10,2) not null,
  stock_quantity int default 0,
  category text,
  specifications text,
  images text[], -- Array of image URLs
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 2. Security (Row Level Security)
ALTER TABLE products ENABLE ROW LEVEL SECURITY;

-- 3. Policy: Allow public read access
CREATE POLICY "Public products are viewable by everyone" 
ON products FOR SELECT 
USING (true);
```

## 3. Storage Strategy (Images)

We use Supabase Storage instead of local assets to ensure fast loading (CDN) and dynamic updates.

### 3.1 Bucket Configuration

- **Bucket Name:** `product-images`
- **Access Level:** Public (Must be enabled)

### 3.2 How to Update Images

1. Go to Supabase Dashboard → Storage → `product-images`
2. Upload your image (Recommended: WebP/JPG, 800x800px)
3. Click "Get URL" on the uploaded file
4. Update the database via Table Editor or SQL

## 4. Operational Guide (SQL Snippets)

Use the SQL Editor in Supabase to manage your shop data.

### 4.1 Restocking Inventory

Update stock for a specific category:

```sql
UPDATE products 
SET stock_quantity = 1000 
WHERE category = 'day';
```

### 4.2 Updating Price

Change price for a specific item:

```sql
UPDATE products 
SET price = 14.50 
WHERE category = 'night';
```

### 4.3 Adding/Updating Product Images

Update the image gallery for a product:

```sql
UPDATE products 
SET images = ARRAY[
  'https://your-project.supabase.co/storage/.../cover.jpg',
  'https://your-project.supabase.co/storage/.../detail.jpg'
]
WHERE category = 'day';
```

## 5. Frontend Integration Pattern

Use this pattern in your React components to fetch data:

```javascript
import { useEffect, useState } from 'react'
import { supabase } from './supabaseClient'

export default function ProductList() {
  const [products, setProducts] = useState([])

  useEffect(() => {
    fetchProducts()
  }, [])

  async function fetchProducts() {
    const { data, error } = await supabase
      .from('products')
      .select('*')
      .order('id', { ascending: true })
    
    if (error) {
      console.error('Error fetching products:', error)
    } else {
      setProducts(data)
    }
  }

  // Render logic...
}
```

## 6. Troubleshooting

**Issue:** Returns empty array `[]` instead of data.  
**Fix:** Check if RLS (Row Level Security) is enabled. If so, ensure the "Public Select" policy is created.

**Issue:** Images not loading.  
**Fix:** Ensure the Storage Bucket is set to Public. Copy the URL into a browser incognito tab to test.

**Issue:** Connection Error.  
**Fix:** Verify `.env.local` variables are correct and restart the terminal.

---

## License

This project is for educational purposes.